(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&l(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function l(o){if(o.ep)return;o.ep=!0;const n=r(o);fetch(o.href,n)}})();const s="stockflow_access_token",a="stockflow_refresh_token",c="stockflow_storage_mode",d="http://localhost:8000";function m(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r=e+"=".repeat((4-e.length%4)%4);return atob(r)}function f(t){if(!t||typeof t!="string")return null;const e=t.split(".");if(e.length!==3)return null;try{const r=m(e[1]);return JSON.parse(r)}catch{return null}}function u(){return localStorage.getItem(s)||sessionStorage.getItem(s)}function p(t,e,r=!0){if(r){localStorage.setItem(s,t),localStorage.setItem(a,e),localStorage.setItem(c,"local"),sessionStorage.removeItem(s),sessionStorage.removeItem(a);return}sessionStorage.setItem(s,t),sessionStorage.setItem(a,e),localStorage.setItem(c,"session"),localStorage.removeItem(s),localStorage.removeItem(a)}function S(){return localStorage.getItem(c)!=="session"}function g(){localStorage.removeItem(s),localStorage.removeItem(a),localStorage.removeItem(c),sessionStorage.removeItem(s),sessionStorage.removeItem(a)}function h(){return f(u())?.perfil||null}function I(t){const e=u(),r=f(e);if(!e||!r?.perfil)return window.location.replace("/login/"),null;const l=r.perfil;return t.includes(l)?{role:l,userId:r.sub}:(window.location.replace("/login/"),null)}function y(){g(),window.location.replace("/login/")}async function w(){const t=u();if(!t)throw new Error("Sem token de autenticacao.");const e=await fetch(`${d}/auth/me`,{method:"GET",headers:{Authorization:`Bearer ${t}`}}),r=await e.json().catch(()=>({}));if(!e.ok)throw new Error(r.detail||"Falha ao carregar perfil.");return r}export{S as a,u as b,I as e,w as f,h as g,y as l,p as s};
